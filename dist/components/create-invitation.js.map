{"version":3,"file":"create-invitation.js","sourceRoot":"","sources":["../../src/components/create-invitation.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, css, html } from 'lit';\nimport { contextProvided } from '@holochain-open-dev/context';\nimport { state, query } from 'lit/decorators.js';\nimport { ScopedElementsMixin } from '@open-wc/scoped-elements';\n\n/**mwc-elements imports */\nimport {\n  Card,\n  List,\n  Icon,\n  Button,\n  ListItem,\n  Snackbar,\n} from '@scoped-elements/material-web';\n\nimport { AgentAvatar, ProfilePrompt, SearchAgent } from '@holochain-open-dev/profiles';\n\nimport { InvitationsStore } from '../state/invitations-store';\n\nimport { invitationsStoreContext } from '../context';\nimport { AgentPubKeyB64, Dictionary } from '@holochain-open-dev/core-types';\nimport { sharedStyles } from '../shared-styles';\nimport { StoreSubscriber } from 'lit-svelte-stores';\n\n/**\n * @element create-invitation-form\n */\nexport class CreateInvitation extends ScopedElementsMixin(LitElement) {\n  @contextProvided({ context: invitationsStoreContext })\n  _store!: InvitationsStore;\n\n  @state()\n  invitees: AgentPubKeyB64[] = [];\n\n  _allProfiles = new StoreSubscriber(\n    this,\n    () => this._store?.profilesStore.knownProfiles\n  );\n\n  addInvitee(e: CustomEvent) {\n    this.invitees = [...this.invitees, e.detail.agentPubKey];\n  }\n\n  removeInvitee(index: number) {\n    this.invitees.splice(index, 1);\n    this.requestUpdate();\n  }\n\n  async sendInvitation() {\n    if (this.invitees.length > 0) {\n      try {\n        await this._store.sendInvitation(this.invitees);\n        this.invitees = [];\n      } catch (e) {\n        (this.shadowRoot?.getElementById('error-message') as Snackbar).show();\n      }\n      await this._store.fetchMyPendingInvitations();\n      this.requestUpdate();\n    }\n  }\n\n  async _pedignInvitations() {\n    await this._store.fetchMyPendingInvitations();\n  }\n\n  renderInviteesList() {\n    return html`\n      <mwc-list>\n        ${this.invitees.map(\n          (agentPubKey, index) => html` <mwc-list-item hasMeta graphic=\"avatar\">\n            <agent-avatar slot=\"graphic\" .agentPubKey=${agentPubKey}>\n            </agent-avatar>\n\n            <span>${this._allProfiles.value[agentPubKey]?.nickname || ''}</span>\n            <mwc-icon\n              slot=\"meta\"\n              id=\"${agentPubKey}\"\n              @click=${() => this.removeInvitee(index)}\n              >close</mwc-icon\n            >\n          </mwc-list-item>`\n        )}\n      </mwc-list>\n    `;\n  }\n\n  renderInvitationError() {\n    return html`<mwc-snackbar\n      id=\"error-message\"\n      labelText=\"Can't send invitation. Please try again later.\"\n    ></mwc-snackbar>`;\n  }\n\n  render() {\n    return html`\n      ${this.renderInvitationError()}\n      <mwc-card style=\"flex: 1;\">\n        <div class=\"column\" style=\"margin: 16px; flex: 1;\">\n          <span class=\"title\" style=\"margin-bottom: 16px;\"\n            >Create Invitation</span\n          >\n          <search-agent\n            @agent-selected=\"${this.addInvitee}\"\n            clear-on-select\n            style=\"margin-bottom: 16px;\"\n          ></search-agent>\n\n          <div\n            class=\"flex-scrollable-parent\"\n            style=\"flex: 1; margin-bottom: 16px;\"\n          >\n            <div class=\"flex-scrollable-container\">\n              <div class=\"flex-scrollable-y\">${this.renderInviteesList()}</div>\n            </div>\n          </div>\n\n          <mwc-button\n            label=\"Send Invitation\"\n            @click=${this.sendInvitation}\n            .disabled=${Object.keys(this.invitees).length === 0}\n          >\n            <mwc-icon slot=\"icon\">send</mwc-icon>\n          </mwc-button>\n        </div>\n      </mwc-card>\n    `;\n  }\n\n  static get scopedElements() {\n    return {\n      'search-agent': SearchAgent,\n      'agent-avatar': AgentAvatar,\n      'profile-prompt': ProfilePrompt,\n      'mwc-icon': Icon,\n      'mwc-list': List,\n      'mwc-card': Card,\n      'mwc-list-item': ListItem,\n      'mwc-snackbar': Snackbar,\n      'mwc-button': Button,\n    };\n  }\n\n  static get styles() {\n    return [\n      sharedStyles,\n      css`\n        :host {\n          display: flex;\n        }\n      `,\n    ];\n  }\n}\n"]}