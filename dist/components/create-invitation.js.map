{"version":3,"file":"create-invitation.js","sourceRoot":"","sources":["../../src/components/create-invitation.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, css, html } from 'lit';\nimport { contextProvided } from '@holochain-open-dev/context';\nimport { state, query } from 'lit/decorators.js';\nimport { ScopedElementsMixin } from '@open-wc/scoped-elements';\n\n/**mwc-elements imports */\nimport {\n  Card,\n  List,\n  Icon,\n  Button,\n  ListItem,\n  Snackbar,\n} from '@scoped-elements/material-web';\n\nimport { ProfilePrompt, SearchAgent } from '@holochain-open-dev/profiles';\n\nimport { InvitationsStore } from '../state/invitations-store';\n\nimport { invitationsStoreContext } from '../context';\nimport { AgentPubKeyB64, Dictionary } from '@holochain-open-dev/core-types';\nimport { sharedStyles } from '../shared-styles';\n\n/**\n * @element create-invitation-form\n */\nexport class CreateInvitation extends ScopedElementsMixin(LitElement) {\n  @contextProvided({ context: invitationsStoreContext })\n  _store!: InvitationsStore;\n\n  @state()\n  invitees: Dictionary<string> = {};\n\n  addInvitee(e: CustomEvent) {\n    this.invitees[e.detail.agent.agent_pub_key] =\n      e.detail.agent.profile.nickname;\n    this.requestUpdate();\n  }\n\n  removeInvitee(e: Event) {\n    const node: any = e.target;\n    delete this.invitees[node.id];\n    this.requestUpdate();\n  }\n\n  async sendInvitation() {\n    //this is the input for the create invitation method define in the holochain side\n    const invitees_list: AgentPubKeyB64[] = [];\n\n    Object.entries(this.invitees).map(element => {\n      invitees_list.push(element[0]);\n      delete this.invitees[element[0]];\n    });\n\n    if (invitees_list.length > 0) {\n      try {\n        await this._store.sendInvitation(invitees_list);\n      } catch (e) {\n        (this.shadowRoot?.getElementById('error-message') as Snackbar).show();\n      }\n      await this._store.fetchMyPendingInvitations();\n      this.requestUpdate();\n    }\n  }\n\n  async _pedignInvitations() {\n    await this._store.fetchMyPendingInvitations();\n  }\n\n  renderInviteesList() {\n    const invitees = Object.entries(this.invitees);\n    return html`\n      <mwc-list>\n        ${invitees.map(element => {\n          const invitee_nickname = element[1];\n\n          return html` <mwc-list-item hasMeta>\n            <span>${invitee_nickname}</span>\n            <mwc-icon\n              slot=\"meta\"\n              id=\"${element[0]}\"\n              @click=\"${this.removeInvitee}\"\n              >close</mwc-icon\n            >\n          </mwc-list-item>`;\n        })}\n      </mwc-list>\n    `;\n  }\n\n  renderInvitationError() {\n    return html`<mwc-snackbar\n      id=\"error-message\"\n      labelText=\"Can't send invitation. Please try again later.\"\n    ></mwc-snackbar>`;\n  }\n\n  render() {\n    return html`\n      ${this.renderInvitationError()}\n      <mwc-card style=\"flex: 1;\">\n        <div class=\"column\" style=\"margin: 16px; flex: 1;\">\n          <span class=\"title\" style=\"margin-bottom: 16px;\"\n            >Create Invitation</span\n          >\n          <search-agent\n            @agent-selected=\"${this.addInvitee}\"\n            clear-on-select\n            style=\"margin-bottom: 16px;\"\n          ></search-agent>\n\n          <div\n            class=\"flex-scrollable-parent\"\n            style=\"flex: 1; margin-bottom: 16px;\"\n          >\n            <div class=\"flex-scrollable-container\">\n              <div class=\"flex-scrollable-y\">${this.renderInviteesList()}</div>\n            </div>\n          </div>\n\n          <mwc-button\n            label=\"Send Invitation\"\n            @click=${this.sendInvitation}\n            .disabled=${Object.keys(this.invitees).length === 0}\n          >\n            <mwc-icon slot=\"icon\">send</mwc-icon>\n          </mwc-button>\n        </div>\n      </mwc-card>\n    `;\n  }\n\n  static get scopedElements() {\n    return {\n      'search-agent': SearchAgent,\n      'profile-prompt': ProfilePrompt,\n      'mwc-icon': Icon,\n      'mwc-list': List,\n      'mwc-card': Card,\n      'mwc-list-item': ListItem,\n      'mwc-snackbar': Snackbar,\n      'mwc-button': Button,\n    };\n  }\n\n  static get styles() {\n    return [\n      sharedStyles,\n      css`\n        :host {\n          display: flex;\n        }\n      `,\n    ];\n  }\n}\n"]}